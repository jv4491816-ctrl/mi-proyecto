<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guitarra Fácil - Aprende Guitarra desde Cero</title>
    <style>
        :root {
            --primary-color: #3498db;          /* Azul celeste */
            --secondary-color: #1a1a2e;        /* Azul oscuro casi negro */
            --dark-blue: #16213e;              /* Azul noche */
            --light-blue: #4cc9f0;             /* Azul claro */
            --white: #ffffff;
            --light-gray: #f5f7fa;
            --medium-gray: #e1e5eb;
            --text-dark: #1a1a2e;
            --text-light: #ffffff;
            --accent-color: #3498db;
            --success-color: #2ecc71;
            --strong-beat-color: #e74c3c;
            --weak-beat-color: #f39c12;
            --inactive-beat-color: #bdc3c7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        body {
            background-color: var(--white);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-weight: 300;
        }
        
        /* ========== HEADER MODERNO ========== */
        header {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--white);
        }
        
        .logo i {
            font-size: 1.8rem;
            color: var(--primary-color);
        }
        
        .logo span {
            background: linear-gradient(135deg, var(--primary-color), var(--light-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-links li {
            position: relative;
        }
        
        .nav-links a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            opacity: 0.9;
        }
        
        .nav-links a:hover {
            background-color: rgba(52, 152, 219, 0.15);
            color: var(--primary-color);
            opacity: 1;
            transform: translateY(-1px);
        }
        
        .nav-links a.active {
            background-color: rgba(52, 152, 219, 0.2);
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Sección de autenticación */
        .auth-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .role-badge {
            background: var(--primary-color);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-admin {
            background-color: var(--dark-blue);
            color: var(--white);
            border: none;
            padding: 8px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .btn-admin:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 26, 46, 0.3);
        }

        /* ========== HERO SECTION MODERNA ========== */
        .hero {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--dark-blue) 100%);
            color: var(--white);
            padding: 6rem 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 3rem;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="%233498db" opacity="0.05"/></svg>');
            background-size: cover;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 800;
            background: linear-gradient(to right, var(--white), var(--light-blue));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2.5rem;
            opacity: 0.9;
            line-height: 1.8;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary-color), var(--light-blue));
            color: var(--white);
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(52, 152, 219, 0.4);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }

        /* ========== FEATURES MODERNOS ========== */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
            flex: 1;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
            color: var(--text-dark);
        }
        
        .section-title h2 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .section-title p {
            font-size: 1.1rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
        }
        
        .feature-card {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            text-align: center;
            cursor: pointer;
            border: 1px solid var(--medium-gray);
            position: relative;
            overflow: hidden;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary-color), var(--light-blue));
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }
        
        .feature-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-color), var(--light-blue));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: var(--white);
            font-size: 1.8rem;
        }
        
        .feature-card h3 {
            color: var(--text-dark);
            margin-bottom: 1rem;
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .feature-card p {
            color: #666;
            line-height: 1.6;
        }

        /* ========== DASHBOARDS MODERNOS ========== */
        .student-dashboard, .admin-panel {
            background: var(--white);
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--medium-gray);
        }
        
        .student-dashboard {
            border-left: 4px solid var(--primary-color);
        }
        
        .admin-panel {
            border-left: 4px solid var(--dark-blue);
        }
        
        .dashboard-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-header i {
            font-size: 2rem;
            color: var(--primary-color);
        }
        
        .dashboard-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .progress-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .progress-item {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }
        
        .progress-item span {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-top: 0.5rem;
        }
        
        .admin-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }
        
        .admin-actions button {
            background: var(--dark-blue);
            color: var(--white);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .admin-actions button:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        /* ========== AFINADOR MEJORADO ========== */
        .afinador-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--dark-blue) 100%);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
            color: var(--white);
        }

        .afinador-header {
            margin-bottom: 30px;
        }

        .afinador-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--white);
        }

        .afinador-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .target-frequency {
            font-size: 1.1rem;
            color: var(--light-blue);
            font-weight: bold;
            margin-bottom: 20px;
        }

        .string-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .string-btn {
            padding: 12px 8px;
            border: 2px solid;
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .string-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.2);
        }

        .string-btn.active {
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
            filter: brightness(1.3);
        }

        /* Colores de cuerdas actualizados para combinar con el diseño */
        .string-btn.mi-high {
            background: var(--primary-color);
            border-color: #2980b9;
        }

        .string-btn.si {
            background: #2ecc71;
            border-color: #27ae60;
        }

        .string-btn.sol {
            background: #9b59b6;
            border-color: #8e44ad;
        }

        .string-btn.re {
            background: #e74c3c;
            border-color: #c0392b;
        }

        .string-btn.la {
            background: #f39c12;
            border-color: #d35400;
        }

        .string-btn.mi-low {
            background: #1abc9c;
            border-color: #16a085;
        }

        .string-number {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .string-note {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .tuner-display {
            margin: 30px 0;
        }

        .circle-indicator {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 4px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .circle-indicator.perfect {
            background: rgba(46, 204, 113, 0.2);
            border-color: #2ecc71;
            box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
        }

        .circle-indicator.sharp {
            background: rgba(243, 156, 18, 0.2);
            border-color: #f39c12;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.5);
        }

        .circle-indicator.flat {
            background: rgba(231, 76, 60, 0.2);
            border-color: #e74c3c;
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);
        }

        .deviation-display {
            font-size: 1.5rem;
            margin: 20px 0;
            height: 30px;
            font-weight: bold;
        }

        .frequency-display {
            font-size: 1.2rem;
            margin: 15px 0;
            color: var(--light-blue);
        }

        .cents-display {
            font-size: 1.3rem;
            margin: 10px 0;
            color: #f39c12;
            font-weight: bold;
        }

        .needle-container {
            height: 100px;
            position: relative;
            margin: 30px 0;
        }

        .needle-scale {
            height: 4px;
            background: linear-gradient(to right, #e74c3c, #f39c12, #2ecc71, #f39c12, #e74c3c);
            border-radius: 2px;
            position: relative;
            margin: 48px 20px 0;
        }

        .needle {
            width: 2px;
            height: 60px;
            background: white;
            position: absolute;
            top: 0;
            left: 50%;
            transform-origin: bottom center;
            transition: transform 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .needle-center {
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .scale-marks {
            display: flex;
            justify-content: space-between;
            margin: 5px 20px 0;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }

        .afinador-controls {
            margin: 30px 0 20px;
        }

        .afinador-btn {
            padding: 15px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .afinador-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }

        .afinador-btn:active {
            transform: translateY(0);
        }

        .afinador-btn.listening {
            background: #2ecc71;
            animation: pulse 1.5s infinite;
        }

        .afinador-status {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .afinador-instructions {
            margin-top: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .signal-quality {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .quality-bar {
            width: 150px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .quality-level {
            height: 100%;
            background: linear-gradient(to right, #e74c3c, #f39c12, #2ecc71);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* ========== METRÓNOMO MEJORADO ========== */
        .metronomo-container {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--dark-blue) 100%);
            color: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            margin-bottom: 2rem;
        }

        .metronomo-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .bpm-display {
            margin-bottom: 40px;
            text-align: center;
        }

        .bpm-value {
            font-size: 5rem;
            font-weight: 700;
            color: var(--text-dark);
            text-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
            line-height: 1;
        }

        .bpm-label {
            font-size: 1rem;
            color: var(--primary-color);
            margin-top: 5px;
            font-weight: 600;
        }

        .bpm-control {
            margin: 30px 0;
        }

        .slider-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }

        .slider {
            width: 100%;
            height: 12px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(to right, var(--primary-color), var(--dark-blue));
            border-radius: 6px;
            outline: none;
            margin-bottom: 10px;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
        }

        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            border: 3px solid var(--primary-color);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.7);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            color: var(--text-dark);
            font-weight: 600;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .control-group {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--medium-gray);
            transition: all 0.3s;
        }

        .control-group:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .control-label {
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .time-input {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--text-dark);
            font-size: 1.5rem;
            width: 70px;
            height: 70px;
            text-align: center;
            border-radius: 10px;
            font-weight: bold;
            margin: 0 auto;
            display: block;
        }

        .time-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
        }

        .subdivision-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .subdivision-btn {
            background: white;
            border: 2px solid var(--medium-gray);
            color: var(--text-dark);
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .subdivision-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .subdivision-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .beat-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .beat-cell {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-dark);
            border: 2px solid var(--medium-gray);
            transition: all 0.1s;
        }

        .beat-cell.active {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
        }

        .beat-cell.accent {
            border-color: var(--dark-blue);
            font-weight: 800;
        }

        .beat-cell.accent.active {
            background: var(--dark-blue);
            color: white;
            box-shadow: 0 0 15px rgba(44, 62, 80, 0.5);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .action-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-weight: bold;
            min-width: 180px;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .start-btn {
            background: linear-gradient(to right, var(--primary-color), #2980b9);
            color: white;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }

        .stop-btn {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
        }

        .stop-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        .tap-tempo-btn {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-weight: bold;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tap-tempo-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }

        .shortcuts-info {
            margin-top: 30px;
            padding: 15px;
            background: var(--light-gray);
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .shortcuts-info i {
            color: var(--primary-color);
            margin-right: 8px;
        }

        /* ========== FOOTER MODERNO ========== */
        footer {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 3rem 1rem;
            text-align: center;
            margin-top: auto;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }
        
        .footer-content p {
            opacity: 0.8;
            max-width: 600px;
            line-height: 1.6;
        }
        
        .social-links {
            display: flex;
            gap: 1.5rem;
            margin: 1rem 0;
        }
        
        .social-links a {
            color: var(--white);
            font-size: 1.5rem;
            transition: all 0.3s;
            opacity: 0.8;
        }
        
        .social-links a:hover {
            color: var(--primary-color);
            opacity: 1;
            transform: translateY(-3px);
        }
        
        .copyright {
            margin-top: 1rem;
            font-size: 0.9rem;
            opacity: 0.6;
        }

        /* ========== PAGES ========== */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            margin-bottom: 2rem;
            padding: 0.8rem 1.5rem;
            background: var(--light-gray);
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: var(--medium-gray);
            transform: translateX(-5px);
        }

        /* ========== MODAL MODERNO MEJORADO ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-container {
            display: flex;
            width: 90%;
            max-width: 900px;
            background: var(--white);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-welcome-section {
            flex: 1;
            background: linear-gradient(135deg, var(--secondary-color), var(--dark-blue));
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: var(--white);
            position: relative;
        }

        .modal-welcome-section h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--white);
        }

        .modal-welcome-section h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .modal-welcome-section p {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .modal-welcome-section .highlight {
            color: #fff;
            background: var(--primary-color);
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: 600;
        }

        .modal-guitar-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: var(--primary-color);
            background: var(--white);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .modal-nav-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 14px;
        }

        .modal-signup-btn {
            background: transparent;
            border: 2px solid var(--white);
            color: var(--white);
        }

        .modal-login-btn-nav {
            background: var(--white);
            color: var(--secondary-color);
        }

        .modal-nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: transparent;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close-btn:hover {
            transform: rotate(90deg);
        }

        .modal-form-section {
            flex: 1;
            padding: 40px 30px;
            background: var(--white);
            color: var(--secondary-color);
            max-height: 600px;
            overflow-y: auto;
        }

        .modal-form-header {
            margin-bottom: 25px;
        }

        .modal-form-header h2 {
            font-size: 1.8rem;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        .modal-form-header p {
            color: #666;
        }

        .modal-form-group {
            margin-bottom: 20px;
        }

        .modal-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .modal-input-with-icon {
            position: relative;
        }

        .modal-input-with-icon i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
        }

        .modal-input-with-icon input {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            background: var(--light-gray);
            color: var(--text-dark);
        }

        .modal-input-with-icon input:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--white);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .modal-forgot-password {
            text-align: right;
            margin-bottom: 20px;
        }

        .modal-forgot-password a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }

        .modal-forgot-password a:hover {
            text-decoration: underline;
        }

        .modal-submit-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--light-blue));
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .modal-submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .modal-submit-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .modal-separator {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #888;
        }

        .modal-separator::before,
        .modal-separator::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--medium-gray);
        }

        .modal-separator span {
            padding: 0 15px;
            font-size: 13px;
        }

        .modal-social-login {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .modal-social-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--light-gray);
            border: 2px solid var(--medium-gray);
            cursor: pointer;
            transition: all 0.3s;
            color: var(--text-dark);
        }

        .modal-social-btn:hover {
            transform: translateY(-2px);
            border-color: var(--primary-color);
        }

        .modal-signup-link {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }

        .modal-signup-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .modal-signup-link a:hover {
            text-decoration: underline;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: block;
            min-height: 18px;
        }

        .input-with-icon.error input {
            border-color: #e74c3c;
        }

        .input-with-icon.success input {
            border-color: #27ae60;
        }

        .success-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71) !important;
        }

        .error-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--secondary-color);
                flex-direction: column;
                padding: 1rem;
                gap: 0.5rem;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }
            
            .nav-links.active {
                display: flex;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .section-title h2 {
                font-size: 2rem;
            }
            
            .auth-section {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .btn-outline, .btn-admin {
                width: 100%;
                text-align: center;
            }
            
            .string-selector {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .modal-container {
                flex-direction: column;
                max-height: 90vh;
                overflow-y: auto;
            }
            
            .modal-welcome-section, .modal-form-section {
                padding: 30px 20px;
            }
            
            .modal-welcome-section h1 {
                font-size: 1.8rem;
            }
            
            .modal-welcome-section h2 {
                font-size: 1.3rem;
            }
            
            .modal-nav-buttons {
                flex-direction: column;
            }
            
            .modal-form-section {
                max-height: none;
            }
            
            .afinador-container {
                padding: 20px;
            }
            
            .afinador-header h1 {
                font-size: 2rem;
            }
            
            .circle-indicator {
                width: 150px;
                height: 150px;
                font-size: 2.5rem;
            }
            
            .afinador-btn {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .metronomo-card {
                padding: 30px 20px;
            }
            
            .bpm-value {
                font-size: 4rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .control-group {
                max-width: 250px;
                margin: 0 auto;
            }
            
            .beat-cell {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .hero {
                padding: 4rem 1rem;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .feature-card {
                padding: 2rem 1.5rem;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .admin-actions button {
                width: 100%;
            }
            
            .beat-display {
                gap: 5px;
            }
            
            .beat-cell {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .time-input {
                width: 60px;
                height: 60px;
                font-size: 1.3rem;
            }
            
            .bpm-value {
                font-size: 3rem;
            }
        }

        /* ========== HAMBURGER MENU ========== */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
        }

        /* ========== ANIMATIONS ========== */
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <i class="fas fa-guitar floating"></i>
                <span>Guitarra Fácil</span>
            </div>
            
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <ul class="nav-links" id="navLinks">
                <li><a href="#" class="nav-link active" data-page="index">Inicio</a></li>
                <li><a href="#" class="nav-link" data-page="afinacion-tips">Afinación y Tips</a></li>
                <li><a href="#" class="nav-link" data-page="metronomo">Metrónomo</a></li>
                <li><a href="#" class="nav-link" data-page="partituras">Partituras</a></li>
                <li><a href="#" class="nav-link" data-page="aprendizaje">Aprendizaje</a></li>
                <li><a href="#" class="nav-link" data-page="guitarra">Guitarra</a></li>
                
                <li>
                    <div class="auth-section">
                        <div id="auth-buttons">
                            <div class="login-options" style="display: flex; gap: 10px;">
                                <button id="student-login-btn" class="btn-outline">Estudiante</button>
                                <button id="admin-login-btn" class="btn-admin">Administrador</button>
                            </div>
                        </div>
                        <div id="user-info" style="display: none; align-items: center; gap: 10px;">
                            <span id="user-name" style="color: white;"></span>
                            <span id="user-role" class="role-badge"></span>
                            <button id="logout-btn" class="btn-outline" style="padding: 6px 12px; font-size: 0.9rem;">Cerrar Sesión</button>
                        </div>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Modal de Login/Registro Mejorado -->
    <div id="loginModal" class="modal">
        <div class="modal-container">
            <div class="modal-welcome-section">
                <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
                <div class="modal-guitar-icon">
                    <i class="fas fa-guitar"></i>
                </div>
                <h1>¡Hola!...Músico</h1>
                <h2>Aprende Guitarra, <span class="highlight">Domina la Música</span></h2>
                <p>Domina la guitarra y descubre el músico que llevas dentro. Aprende a tu ritmo con nuestros cursos especializados, desde principiante hasta avanzado.</p>
                <div class="modal-nav-buttons">
                    <button class="modal-nav-btn modal-signup-btn" id="modalSignupBtn">REGISTRARSE</button>
                    <button class="modal-nav-btn modal-login-btn-nav" id="modalLoginBtn">INICIAR SESIÓN</button>
                </div>
            </div>
            
            <div class="modal-form-section" id="modalFormSection">
                <!-- El contenido del formulario se cargará dinámicamente -->
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Página de Inicio -->
        <div id="index" class="page active">
            <section class="hero">
                <div class="hero-content">
                    <h1>Aprende Guitarra desde Cero</h1>
                    <p>Domina la guitarra con herramientas profesionales, lecciones estructuradas y una comunidad que te apoya en cada paso.</p>
                    <a href="#" class="btn" data-page="afinacion-tips">Comenzar a Aprender</a>
                </div>
            </section>

            <!-- Dashboard para estudiantes -->
            <div id="student-dashboard" class="student-dashboard student-only" style="display: none;">
                <div class="dashboard-header">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Mi Progreso</h3>
                </div>
                <p>Bienvenido de vuelta, <span id="student-welcome-name" style="font-weight: 600; color: var(--primary-color);"></span>!</p>
                <div class="progress-info">
                    <div class="progress-item">
                        <p>Nivel Actual</p>
                        <span id="student-level">1</span>
                    </div>
                    <div class="progress-item">
                        <p>Progreso General</p>
                        <span id="student-progress">0%</span>
                    </div>
                    <div class="progress-item">
                        <p>Lecciones Completadas</p>
                        <span id="student-lessons">0</span>
                    </div>
                </div>
            </div>

            <!-- Panel de administración -->
            <div id="admin-panel" class="admin-panel admin-only" style="display: none;">
                <div class="dashboard-header">
                    <i class="fas fa-cog"></i>
                    <h3>Panel de Administración</h3>
                </div>
                <p>Bienvenido, <span id="admin-welcome-name" style="font-weight: 600; color: var(--dark-blue);"></span></p>
                <div class="admin-actions">
                    <button class="btn" onclick="manageUsers()">Gestionar Usuarios</button>
                    <button class="btn" onclick="manageContent()">Gestionar Contenido</button>
                    <button class="btn" onclick="viewStatistics()">Ver Estadísticas</button>
                </div>
            </div>

            <!-- Sección de características -->
            <div class="section-title">
                <h2>Herramientas para Tu Aprendizaje</h2>
                <p>Todo lo que necesitas para dominar la guitarra en un solo lugar</p>
            </div>

            <section class="features">
                <div class="feature-card" data-page="metronomo">
                    <div class="feature-icon">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <h3>Metrónomo Inteligente</h3>
                    <p>Mantén el ritmo perfecto mientras practicas con nuestro metrónomo avanzado</p>
                </div>
                
                <div class="feature-card" data-page="afinacion-tips">
                    <div class="feature-icon">
                        <i class="fas fa-music"></i>
                    </div>
                    <h3>Afinador Profesional</h3>
                    <p>Afinación precisa y consejos expertos para mejorar tu técnica</p>
                </div>
                
                <div class="feature-card" data-page="partituras">
                    <div class="feature-icon">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <h3>Biblioteca de Partituras</h3>
                    <p>Canciones para todos los niveles, desde principiantes hasta avanzados</p>
                </div>
                
                <div class="feature-card" data-page="aprendizaje">
                    <div class="feature-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h3>Sistema de Aprendizaje</h3>
                    <p>Lecciones estructuradas de básico a intermedio con seguimiento de progreso</p>
                </div>
            </section>

            <!-- Contenido exclusivo para estudiantes -->
            <div class="student-only" style="display: none;">
                <div class="section-title">
                    <h2>Mis Lecciones</h2>
                    <p>Continúa tu aprendizaje desde donde lo dejaste</p>
                </div>
                
                <div class="features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-play-circle"></i>
                        </div>
                        <h3>Continuar Aprendiendo</h3>
                        <p>Retoma tu última lección y sigue tu progreso personalizado</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Mi Progreso Detallado</h3>
                        <p>Analiza tu avance con estadísticas y gráficos interactivos</p>
                    </div>
                </div>
            </div>

            <!-- Contenido exclusivo para administradores -->
            <div class="admin-only" style="display: none;">
                <div class="section-title">
                    <h2>Herramientas de Administración</h2>
                    <p>Gestiona todos los aspectos de la plataforma</p>
                </div>
                
                <div class="features">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h3>Gestión de Usuarios</h3>
                        <p>Administra estudiantes, permisos y seguimiento de actividad</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h3>Gestión de Contenido</h3>
                        <p>Crea y actualiza lecciones, ejercicios y materiales educativos</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Página de Afinación y Tips con el Afinador Mejorado -->
        <div id="afinacion-tips" class="page">
            <a href="#" class="back-btn" data-page="index"><i class="fas fa-arrow-left"></i> Volver al Inicio</a>
            <div class="section-title">
                <h2>Afinador Profesional</h2>
                <p>Afinación precisa para cada cuerda de tu guitarra</p>
            </div>
            
            <div class="afinador-container">
                <div class="afinador-header">
                    <h1>Afinador Maximus</h1>
                    <p class="afinador-subtitle">Afinador para 6 Cuerdas</p>
                    <p class="target-frequency" id="targetFrequency">Frecuencia objetivo: <strong>329.63 Hz</strong> (Mi - E4)</p>
                </div>

                <div class="string-selector">
                    <button class="string-btn mi-high active" data-string="mi-high" data-frequency="329.63" data-note="E4">
                        <span class="string-number">1ª</span>
                        <span class="string-note">MI</span>
                    </button>
                    <button class="string-btn si" data-string="si" data-frequency="246.94" data-note="B3">
                        <span class="string-number">2ª</span>
                        <span class="string-note">SI</span>
                    </button>
                    <button class="string-btn sol" data-string="sol" data-frequency="196.00" data-note="G3">
                        <span class="string-number">3ª</span>
                        <span class="string-note">SOL</span>
                    </button>
                    <button class="string-btn re" data-string="re" data-frequency="146.83" data-note="D3">
                        <span class="string-number">4ª</span>
                        <span class="string-note">RE</span>
                    </button>
                    <button class="string-btn la" data-string="la" data-frequency="110.00" data-note="A2">
                        <span class="string-number">5ª</span>
                        <span class="string-note">LA</span>
                    </button>
                    <button class="string-btn mi-low" data-string="mi-low" data-frequency="82.41" data-note="E2">
                        <span class="string-number">6ª</span>
                        <span class="string-note">MI</span>
                    </button>
                </div>

                <div class="tuner-display">
                    <div class="circle-indicator" id="circleIndicator">
                        E4
                    </div>
                    
                    <div class="deviation-display" id="deviationText">
                        Selecciona una cuerda
                    </div>
                    
                    <div class="frequency-display" id="frequencyDisplay">
                        -- Hz
                    </div>

                    <div class="cents-display" id="centsDisplay">
                        -- cents
                    </div>

                    <div class="signal-quality">
                        <span>Señal:</span>
                        <div class="quality-bar">
                            <div class="quality-level" id="qualityLevel" style="width: 0%"></div>
                        </div>
                        <span id="qualityValue">0%</span>
                    </div>

                    <div class="needle-container">
                        <div class="needle-scale">
                            <div class="needle" id="needle"></div>
                            <div class="needle-center"></div>
                        </div>
                        <div class="scale-marks">
                            <span>-50</span>
                            <span>-25</span>
                            <span>0</span>
                            <span>+25</span>
                            <span>+50</span>
                        </div>
                    </div>
                </div>

                <div class="afinador-controls">
                    <button class="afinador-btn" id="micToggle">
                        <span>🎤</span> <span id="micStatus">Activar Micrófono</span>
                    </button>
                </div>

                <div class="afinador-status">
                    <div id="statusText">Selecciona una cuerda y activa el micrófono</div>
                </div>

                <div class="afinador-instructions">
                    <p><strong>Instrucciones:</strong></p>
                    <p>1. <strong>Selecciona</strong> la cuerda que quieres afinar</p>
                    <p>2. <strong>Activa el micrófono</strong> y permite el acceso</p>
                    <p>3. <strong>Toca la cuerda seleccionada</strong> de tu guitarra</p>
                    <p>4. <strong>Ajusta</strong> hasta que esté en <strong style="color:#2ecc71">VERDE</strong></p>
                </div>
            </div>
        </div>

        <!-- Página del Metrónomo Mejorado -->
        <div id="metronomo" class="page">
            <a href="#" class="back-btn" data-page="index"><i class="fas fa-arrow-left"></i> Volver al Inicio</a>
            <div class="section-title">
                <h2>Metrónomo Inteligente</h2>
                <p>Mantén el ritmo perfecto en tus prácticas musicales</p>
            </div>
            
            <div class="metronomo-container">
                <div class="metronomo-card">
                    <div class="bpm-display">
                        <div class="bpm-value" id="bpmValue">120</div>
                        <div class="bpm-label">PULSOS POR MINUTO</div>
                    </div>
                    
                    <div class="bpm-control">
                        <div class="slider-container">
                            <input type="range" min="40" max="240" value="120" class="slider" id="bpmSlider">
                            <div class="slider-labels">
                                <span>40</span>
                                <span>140</span>
                                <span>240</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="controls-grid">
                        <div class="control-group">
                            <div class="control-label">COMPÁS</div>
                            <input type="number" min="1" max="4" value="4" class="time-input" id="timeTop">
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">BPM</div>
                            <div class="bpm-value" style="font-size: 2rem; color: var(--text-dark);" id="currentBpm">120</div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">SUBDIVISIÓN</div>
                            <div class="subdivision-buttons" id="subdivisionButtons">
                                <button class="subdivision-btn active" data-value="1">1/1</button>
                                <button class="subdivision-btn" data-value="2">1/2</button>
                                <button class="subdivision-btn" data-value="4">1/4</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="beat-display" id="beatDisplay">
                        <!-- Las celdas de compás se generarán con JavaScript -->
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn start-btn" id="startBtn">
                            <i class="fas fa-play"></i> Iniciar
                        </button>
                        <button class="action-btn stop-btn" id="stopBtn" disabled>
                            <i class="fas fa-stop"></i> Detener
                        </button>
                    </div>
                    
                    <button class="tap-tempo-btn" id="tapTempoBtn">
                        <i class="fas fa-hand-point-up"></i> Tap Tempo
                    </button>
                    
                    <div class="shortcuts-info">
                        <p><i class="fas fa-keyboard"></i> <strong>Atajos de teclado:</strong></p>
                        <p>Espacio: Iniciar/Detener • Flechas ↑↓: Ajustar BPM • T: Tap Tempo</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Otras páginas -->
        <div id="partituras" class="page">
            <a href="#" class="back-btn" data-page="index"><i class="fas fa-arrow-left"></i> Volver al Inicio</a>
            <div class="section-title">
                <h2>Biblioteca de Partituras</h2>
                <p>Encuentra canciones para todos los niveles y estilos musicales</p>
            </div>
            <div class="metronomo-container">
                <div class="metronomo-card">
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-file-alt" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                        <h3 style="margin-bottom: 1rem; color: var(--text-dark);">Colección Musical</h3>
                        <p style="color: #666; max-width: 600px; margin: 0 auto;">Próximamente: Una extensa biblioteca con partituras, tablaturas y lecciones interactivas.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="aprendizaje" class="page">
            <a href="#" class="back-btn" data-page="index"><i class="fas fa-arrow-left"></i> Volver al Inicio</a>
            <div class="section-title">
                <h2>Sistema de Aprendizaje</h2>
                <p>Aprende a tu ritmo con nuestro método estructurado</p>
            </div>
            <div class="metronomo-container">
                <div class="metronomo-card">
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-graduation-cap" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                        <h3 style="margin-bottom: 1rem; color: var(--text-dark);">Cursos Estructurados</h3>
                        <p style="color: #666; max-width: 600px; margin: 0 auto;">Próximamente: Lecciones paso a paso desde nivel básico hasta avanzado con seguimiento de progreso.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="guitarra" class="page">
            <a href="#" class="back-btn" data-page="index"><i class="fas fa-arrow-left"></i> Volver al Inicio</a>
            <div class="section-title">
                <h2>Todo sobre la Guitarra</h2>
                <p>Conoce todo sobre instrumentos, accesorios y mantenimiento</p>
            </div>
            <div class="metronomo-container">
                <div class="metronomo-card">
                    <div style="text-align: center; padding: 2rem;">
                        <i class="fas fa-guitar" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
                        <h3 style="margin-bottom: 1rem; color: var(--text-dark);">Guía Completa</h3>
                        <p style="color: #666; max-width: 600px; margin: 0 auto;">Próximamente: Información detallada sobre guitarras, equipos, mantenimiento y técnicas.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="logo">
                <i class="fas fa-guitar"></i>
                <span>Guitarra Fácil</span>
            </div>
            <p>Tu centro de aprendizaje musical moderno e interactivo. Domina la guitarra a tu ritmo.</p>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
                <a href="#"><i class="fab fa-tiktok"></i></a>
            </div>
            <p class="copyright">&copy; 2024 Guitarra Fácil. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ========== NAVEGACIÓN ENTRE PÁGINAS ==========
            const navLinks = document.querySelectorAll('.nav-link, .back-btn, .feature-card');
            const pages = document.querySelectorAll('.page');
            const menuToggle = document.getElementById('menuToggle');
            const navLinksContainer = document.getElementById('navLinks');

            // Función para cambiar de página
            function showPage(pageId) {
                pages.forEach(page => {
                    page.classList.remove('active');
                });
                document.getElementById(pageId).classList.add('active');
                
                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-page') === pageId) {
                        link.classList.add('active');
                    }
                });
                
                history.pushState({page: pageId}, '', `#${pageId}`);
                
                // Cerrar menú en móvil
                if (window.innerWidth <= 768) {
                    navLinksContainer.classList.remove('active');
                }
                
                // Inicializar herramientas específicas si es necesario
                if (pageId === 'afinacion-tips') {
                    initAfinador();
                } else if (pageId === 'metronomo') {
                    initMetronomo();
                }
            }

            // Event listeners para navegación
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                });
            });

            // Menú hamburguesa
            menuToggle.addEventListener('click', function() {
                navLinksContainer.classList.toggle('active');
            });

            // Cargar página basada en hash
            const initialPage = window.location.hash.substring(1) || 'index';
            showPage(initialPage);

            // ========== SISTEMA DE AUTENTICACIÓN MEJORADO ==========
            const loginModal = document.getElementById('loginModal');
            const modalFormSection = document.getElementById('modalFormSection');
            const modalCloseBtn = document.getElementById('modalCloseBtn');
            const modalSignupBtn = document.getElementById('modalSignupBtn');
            const modalLoginBtn = document.getElementById('modalLoginBtn');
            const studentLoginBtn = document.getElementById('student-login-btn');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const authButtons = document.getElementById('auth-buttons');
            const userInfo = document.getElementById('user-info');
            const userName = document.getElementById('user-name');
            const userRole = document.getElementById('user-role');

            let currentFormType = 'login';
            let currentUser = null;

            // Cargar usuario desde localStorage
            function loadUserFromStorage() {
                const savedUser = localStorage.getItem('guitarraFacilUser');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    updateUIForUser(currentUser);
                }
            }

            // Actualizar UI según usuario
            function updateUIForUser(user) {
                if (user) {
                    authButtons.style.display = 'none';
                    userInfo.style.display = 'flex';
                    userName.textContent = user.name;
                    userRole.textContent = user.role === 'admin' ? 'Administrador' : 'Estudiante';
                    
                    // Mostrar contenido específico
                    const studentElements = document.querySelectorAll('.student-only');
                    const adminElements = document.querySelectorAll('.admin-only');
                    
                    if (user.role === 'admin') {
                        studentElements.forEach(el => el.style.display = 'none');
                        adminElements.forEach(el => el.style.display = 'block');
                        document.getElementById('admin-welcome-name').textContent = user.name;
                    } else {
                        studentElements.forEach(el => el.style.display = 'block');
                        adminElements.forEach(el => el.style.display = 'none');
                        document.getElementById('student-welcome-name').textContent = user.name;
                    }
                } else {
                    authButtons.style.display = 'flex';
                    userInfo.style.display = 'none';
                    document.querySelectorAll('.student-only, .admin-only').forEach(el => el.style.display = 'none');
                }
            }

            // Cargar formulario en el modal
            function loadForm(formType) {
                currentFormType = formType;
                
                if (formType === 'login') {
                    modalFormSection.innerHTML = `
                        <div class="modal-form-header">
                            <h2>Bienvenido de vuelta</h2>
                            <p>Accede a tu cuenta para continuar tu aprendizaje</p>
                        </div>
                        
                        <form id="modalLoginForm">
                            <div class="modal-form-group">
                                <label for="modalUsername">Email o Usuario</label>
                                <div class="modal-input-with-icon" id="modalUsernameContainer">
                                    <i class="fas fa-user"></i>
                                    <input type="text" id="modalUsername" placeholder="Ingresa tu email o usuario" required>
                                </div>
                                <span class="error-message" id="modalUsernameError"></span>
                            </div>
                            
                            <div class="modal-form-group">
                                <label for="modalPassword">Contraseña</label>
                                <div class="modal-input-with-icon" id="modalPasswordContainer">
                                    <i class="fas fa-lock"></i>
                                    <input type="password" id="modalPassword" placeholder="Ingresa tu contraseña" required>
                                    <button type="button" id="togglePasswordBtn" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--primary-color); cursor: pointer;">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <span class="error-message" id="modalPasswordError"></span>
                            </div>
                            
                            <div class="modal-forgot-password">
                                <a href="#" id="modalForgotPassword">¿Olvidaste tu contraseña?</a>
                            </div>
                            
                            <button type="submit" id="modalSubmitBtn" class="modal-submit-btn">
                                <span>INICIAR SESIÓN</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </form>
                        
                        <div class="modal-separator">
                            <span>O continúa con</span>
                        </div>
                        
                        <div class="modal-social-login">
                            <div class="modal-social-btn google">
                                <i class="fab fa-google"></i>
                            </div>
                            <div class="modal-social-btn facebook">
                                <i class="fab fa-facebook-f"></i>
                            </div>
                            <div class="modal-social-btn apple">
                                <i class="fab fa-apple"></i>
                            </div>
                        </div>
                        
                        <div class="modal-signup-link">
                            ¿No tienes una cuenta? <a href="#" id="modalSwitchToSignup">REGÍSTRATE</a>
                        </div>
                    `;
                } else {
                    modalFormSection.innerHTML = `
                        <div class="modal-form-header">
                            <h2>Únete a nuestra comunidad</h2>
                            <p>Crea tu cuenta para comenzar tu viaje musical</p>
                        </div>
                        
                        <form id="modalSignupForm">
                            <div class="modal-form-group">
                                <label for="modalSignupName">Nombre completo</label>
                                <div class="modal-input-with-icon" id="modalSignupNameContainer">
                                    <i class="fas fa-user"></i>
                                    <input type="text" id="modalSignupName" placeholder="Ingresa tu nombre completo" required>
                                </div>
                                <span class="error-message" id="modalSignupNameError"></span>
                            </div>
                            
                            <div class="modal-form-group">
                                <label for="modalSignupEmail">Email</label>
                                <div class="modal-input-with-icon" id="modalSignupEmailContainer">
                                    <i class="fas fa-envelope"></i>
                                    <input type="email" id="modalSignupEmail" placeholder="Ingresa tu email" required>
                                </div>
                                <span class="error-message" id="modalSignupEmailError"></span>
                            </div>
                            
                            <div class="modal-form-group">
                                <label for="modalSignupPassword">Contraseña</label>
                                <div class="modal-input-with-icon" id="modalSignupPasswordContainer">
                                    <i class="fas fa-lock"></i>
                                    <input type="password" id="modalSignupPassword" placeholder="Crea una contraseña segura" required>
                                    <button type="button" id="toggleSignupPasswordBtn" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--primary-color); cursor: pointer;">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                                <span class="error-message" id="modalSignupPasswordError"></span>
                            </div>
                            
                            <button type="submit" id="modalSignupSubmitBtn" class="modal-submit-btn">
                                <span>CREAR CUENTA</span>
                                <i class="fas fa-user-plus"></i>
                            </button>
                        </form>
                        
                        <div class="modal-separator">
                            <span>O regístrate con</span>
                        </div>
                        
                        <div class="modal-social-login">
                            <div class="modal-social-btn google">
                                <i class="fab fa-google"></i>
                            </div>
                            <div class="modal-social-btn facebook">
                                <i class="fab fa-facebook-f"></i>
                            </div>
                            <div class="modal-social-btn apple">
                                <i class="fab fa-apple"></i>
                            </div>
                        </div>
                        
                        <div class="modal-signup-link">
                            ¿Ya tienes una cuenta? <a href="#" id="modalSwitchToLogin">INICIA SESIÓN</a>
                        </div>
                    `;
                }
                
                // Configurar eventos para el formulario cargado
                setupFormEvents();
            }

            // Configurar eventos para el formulario
            function setupFormEvents() {
                if (currentFormType === 'login') {
                    const loginForm = document.getElementById('modalLoginForm');
                    const usernameInput = document.getElementById('modalUsername');
                    const passwordInput = document.getElementById('modalPassword');
                    const togglePasswordBtn = document.getElementById('togglePasswordBtn');
                    const submitBtn = document.getElementById('modalSubmitBtn');
                    const switchToSignup = document.getElementById('modalSwitchToSignup');
                    const forgotPassword = document.getElementById('modalForgotPassword');
                    
                    // Toggle password visibility
                    togglePasswordBtn?.addEventListener('click', function() {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                    });
                    
                    // Switch to signup
                    switchToSignup?.addEventListener('click', function(e) {
                        e.preventDefault();
                        loadForm('signup');
                    });
                    
                    // Forgot password
                    forgotPassword?.addEventListener('click', function(e) {
                        e.preventDefault();
                        handleForgotPassword();
                    });
                    
                    // Login form submission
                    loginForm?.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleLogin();
                    });
                } else {
                    const signupForm = document.getElementById('modalSignupForm');
                    const passwordInput = document.getElementById('modalSignupPassword');
                    const togglePasswordBtn = document.getElementById('toggleSignupPasswordBtn');
                    const submitBtn = document.getElementById('modalSignupSubmitBtn');
                    const switchToLogin = document.getElementById('modalSwitchToLogin');
                    
                    // Toggle password visibility
                    togglePasswordBtn?.addEventListener('click', function() {
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);
                        this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                    });
                    
                    // Switch to login
                    switchToLogin?.addEventListener('click', function(e) {
                        e.preventDefault();
                        loadForm('login');
                    });
                    
                    // Signup form submission
                    signupForm?.addEventListener('submit', function(e) {
                        e.preventDefault();
                        handleSignup();
                    });
                }
            }

            // Manejar login
            async function handleLogin() {
                const username = document.getElementById('modalUsername')?.value.trim();
                const password = document.getElementById('modalPassword')?.value;
                const submitBtn = document.getElementById('modalSubmitBtn');
                
                // Simular proceso de login
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin loading-spinner"></i> Iniciando sesión...';
                
                // Simular delay de red
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Credenciales de demostración
                const demoCredentials = [
                    { username: 'estudiante@demo.com', password: '123456', name: 'Estudiante Demo', role: 'student' },
                    { username: 'admin@demo.com', password: 'admin123', name: 'Administrador Demo', role: 'admin' },
                    { username: 'usuario', password: '123456', name: 'Usuario Regular', role: 'student' }
                ];
                
                const user = demoCredentials.find(
                    cred => (cred.username === username || cred.name.toLowerCase().includes(username.toLowerCase())) && 
                           cred.password === password
                );
                
                if (user) {
                    // Login exitoso
                    currentUser = user;
                    localStorage.setItem('guitarraFacilUser', JSON.stringify(user));
                    updateUIForUser(user);
                    
                    submitBtn.classList.remove('error-btn');
                    submitBtn.classList.add('success-btn');
                    submitBtn.innerHTML = '<i class="fas fa-check"></i> ¡Éxito!';
                    
                    setTimeout(() => {
                        closeModal();
                        alert(`¡Bienvenido de nuevo, ${user.name}!`);
                    }, 500);
                } else {
                    // Credenciales incorrectas
                    submitBtn.classList.remove('success-btn');
                    submitBtn.classList.add('error-btn');
                    submitBtn.innerHTML = '<i class="fas fa-times"></i> Error';
                    
                    setTimeout(() => {
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('error-btn');
                        submitBtn.innerHTML = '<span>INICIAR SESIÓN</span><i class="fas fa-arrow-right"></i>';
                        alert('Credenciales incorrectas. Por favor, inténtalo de nuevo.');
                    }, 500);
                }
            }

            // Manejar registro
            async function handleSignup() {
                const name = document.getElementById('modalSignupName').value.trim();
                const email = document.getElementById('modalSignupEmail').value.trim();
                const password = document.getElementById('modalSignupPassword').value;
                const submitBtn = document.getElementById('modalSignupSubmitBtn');
                
                // Simular proceso de registro
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin loading-spinner"></i> Creando cuenta...';
                
                // Simular delay de red
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Registrar nuevo usuario
                currentUser = {
                    name: name,
                    email: email,
                    role: 'student',
                    createdAt: new Date().toISOString()
                };
                
                localStorage.setItem('guitarraFacilUser', JSON.stringify(currentUser));
                updateUIForUser(currentUser);
                
                submitBtn.classList.remove('error-btn');
                submitBtn.classList.add('success-btn');
                submitBtn.innerHTML = '<i class="fas fa-check"></i> ¡Cuenta creada!';
                
                setTimeout(() => {
                    closeModal();
                    alert(`¡Bienvenido a Guitarra Fácil, ${name}! Tu cuenta ha sido creada exitosamente.`);
                }, 500);
            }

            // Manejar "Olvidé mi contraseña"
            function handleForgotPassword() {
                const email = prompt('Por favor, ingresa tu email para recuperar tu contraseña:');
                if (email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                    alert(`Se ha enviado un enlace de recuperación a: ${email}\n\n(Esta es una demostración. En una aplicación real se enviaría un email real.)`);
                } else if (email) {
                    alert('Por favor, ingresa un email válido.');
                }
            }

            // Manejar logout
            function handleLogout() {
                currentUser = null;
                localStorage.removeItem('guitarraFacilUser');
                updateUIForUser(null);
                alert('Sesión cerrada exitosamente.');
            }

            // Abrir modal
            function openModal(formType = 'login') {
                loadForm(formType);
                loginModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // Cerrar modal
            function closeModal() {
                loginModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }

            // Event Listeners
            studentLoginBtn?.addEventListener('click', () => openModal('login'));
            adminLoginBtn?.addEventListener('click', () => openModal('login'));
            modalCloseBtn?.addEventListener('click', closeModal);
            modalSignupBtn?.addEventListener('click', () => openModal('signup'));
            modalLoginBtn?.addEventListener('click', () => openModal('login'));
            logoutBtn?.addEventListener('click', handleLogout);

            // Cerrar modal al hacer clic fuera
            loginModal?.addEventListener('click', function(e) {
                if (e.target === loginModal) {
                    closeModal();
                }
            });

            // Cargar usuario al iniciar
            loadUserFromStorage();

            // ========== AFINADOR MEJORADO ==========
            // Configuración de cuerdas
            const STRINGS = {
                'mi-high': {
                    frequency: 329.63,
                    note: 'E4',
                    name: '1ª Cuerda - MI',
                    range: { low: 280, high: 400 }
                },
                'si': {
                    frequency: 246.94,
                    note: 'B3',
                    name: '2ª Cuerda - SI',
                    range: { low: 200, high: 320 }
                },
                'sol': {
                    frequency: 196.00,
                    note: 'G3',
                    name: '3ª Cuerda - SOL',
                    range: { low: 160, high: 260 }
                },
                're': {
                    frequency: 146.83,
                    note: 'D3',
                    name: '4ª Cuerda - RE',
                    range: { low: 120, high: 200 }
                },
                'la': {
                    frequency: 110.00,
                    note: 'A2',
                    name: '5ª Cuerda - LA',
                    range: { low: 90, high: 150 }
                },
                'mi-low': {
                    frequency: 82.41,
                    note: 'E2',
                    name: '6ª Cuerda - MI',
                    range: { low: 65, high: 120 }
                }
            };

            // Estado de la aplicación
            const state = {
                audioContext: null,
                analyser: null,
                microphone: null,
                isListening: false,
                animationId: null,
                signalStrength: 0,
                frequencyHistory: [],
                lastValidDetection: null,
                currentString: 'mi-high',
                debugInfo: ''
            };

            // Elementos DOM del afinador
            const elementsAfinador = {
                circleIndicator: document.getElementById('circleIndicator'),
                deviationText: document.getElementById('deviationText'),
                frequencyDisplay: document.getElementById('frequencyDisplay'),
                centsDisplay: document.getElementById('centsDisplay'),
                needle: document.getElementById('needle'),
                micToggle: document.getElementById('micToggle'),
                micStatus: document.getElementById('micStatus'),
                statusText: document.getElementById('statusText'),
                qualityLevel: document.getElementById('qualityLevel'),
                qualityValue: document.getElementById('qualityValue'),
                targetFrequency: document.getElementById('targetFrequency')
            };

            // Inicializar afinador
            function initAfinador() {
                if (!elementsAfinador.circleIndicator) return;
                
                setupEventListenersAfinador();
                updateStringDisplayAfinador();
            }

            // Configurar event listeners del afinador
            function setupEventListenersAfinador() {
                // Botón de micrófono
                elementsAfinador.micToggle?.addEventListener('click', toggleMicrophoneAfinador);
                
                // Botones de selección de cuerda
                document.querySelectorAll('.string-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        selectStringAfinador(this.dataset.string);
                    });
                });
            }

            // Seleccionar cuerda en el afinador
            function selectStringAfinador(stringType) {
                state.currentString = stringType;
                state.frequencyHistory = [];
                state.lastValidDetection = null;
                
                // Actualizar botones activos
                document.querySelectorAll('.string-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeBtn = document.querySelector(`.string-btn[data-string="${stringType}"]`);
                if (activeBtn) activeBtn.classList.add('active');
                
                // Actualizar display
                updateStringDisplayAfinador();
                resetDisplayAfinador();
            }

            // Actualizar display según la cuerda seleccionada
            function updateStringDisplayAfinador() {
                const string = STRINGS[state.currentString];
                if (elementsAfinador.targetFrequency) {
                    elementsAfinador.targetFrequency.innerHTML = 
                        `Frecuencia objetivo: <strong>${string.frequency} Hz</strong> (${string.note})`;
                }
                if (elementsAfinador.circleIndicator) {
                    elementsAfinador.circleIndicator.textContent = string.note;
                }
                if (elementsAfinador.statusText) {
                    elementsAfinador.statusText.textContent = `Seleccionada: ${string.name} - Activa el micrófono`;
                }
            }

            // Alternar micrófono del afinador
            async function toggleMicrophoneAfinador() {
                if (!state.isListening) {
                    try {
                        await startListeningAfinador();
                    } catch (error) {
                        console.error('Error al acceder al micrófono:', error);
                        alert('No se pudo acceder al micrófono. Asegúrate de permitir el acceso.');
                    }
                } else {
                    stopListeningAfinador();
                }
            }

            // Iniciar escucha por micrófono en el afinador
            async function startListeningAfinador() {
                try {
                    state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Configurar analizador
                    state.analyser = state.audioContext.createAnalyser();
                    state.analyser.fftSize = 8192;
                    state.analyser.smoothingTimeConstant = 0.5;
                    
                    // Obtener stream de micrófono
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            autoGainControl: true,
                        }
                    });
                    
                    // Conectar micrófono -> analizador
                    state.microphone = state.audioContext.createMediaStreamSource(stream);
                    state.microphone.connect(state.analyser);
                    
                    state.isListening = true;
                    if (elementsAfinador.micStatus) {
                        elementsAfinador.micStatus.textContent = 'Desactivar Micrófono';
                    }
                    if (elementsAfinador.micToggle) {
                        elementsAfinador.micToggle.classList.add('listening');
                    }
                    
                    const string = STRINGS[state.currentString];
                    if (elementsAfinador.statusText) {
                        elementsAfinador.statusText.textContent = `🎵 Toca la ${string.name} ahora`;
                    }
                    
                    analyzeAudioAfinador();
                    
                } catch (error) {
                    console.error('Error en configuración de audio:', error);
                    throw error;
                }
            }

            // Detener escucha por micrófono en el afinador
            function stopListeningAfinador() {
                if (state.animationId) {
                    cancelAnimationFrame(state.animationId);
                    state.animationId = null;
                }
                
                if (state.microphone) {
                    state.microphone.disconnect();
                    state.microphone = null;
                }
                
                if (state.audioContext) {
                    state.audioContext.close();
                    state.audioContext = null;
                }
                
                state.isListening = false;
                state.frequencyHistory = [];
                state.lastValidDetection = null;
                if (elementsAfinador.micStatus) {
                    elementsAfinador.micStatus.textContent = 'Activar Micrófono';
                }
                if (elementsAfinador.micToggle) {
                    elementsAfinador.micToggle.classList.remove('listening');
                }
                
                const string = STRINGS[state.currentString];
                if (elementsAfinador.statusText) {
                    elementsAfinador.statusText.textContent = `Micrófono desactivado - ${string.name}`;
                }
                
                resetDisplayAfinador();
            }

            // Resetear display del afinador
            function resetDisplayAfinador() {
                if (elementsAfinador.circleIndicator) {
                    elementsAfinador.circleIndicator.className = 'circle-indicator';
                }
                if (elementsAfinador.deviationText) {
                    elementsAfinador.deviationText.textContent = 'Activa el micrófono';
                }
                if (elementsAfinador.frequencyDisplay) {
                    elementsAfinador.frequencyDisplay.textContent = '-- Hz';
                }
                if (elementsAfinador.centsDisplay) {
                    elementsAfinador.centsDisplay.textContent = '-- cents';
                }
                if (elementsAfinador.needle) {
                    elementsAfinador.needle.style.transform = 'rotate(0deg)';
                }
                if (elementsAfinador.qualityLevel) {
                    elementsAfinador.qualityLevel.style.width = '0%';
                }
                if (elementsAfinador.qualityValue) {
                    elementsAfinador.qualityValue.textContent = '0%';
                }
            }

            // Añadir frecuencia al historial para promedio móvil
            function addToFrequencyHistory(frequency) {
                state.frequencyHistory.push(frequency);
                
                if (state.frequencyHistory.length > 8) {
                    state.frequencyHistory.shift();
                }
            }

            // Calcular promedio móvil de frecuencias
            function calculateMovingAverage() {
                if (state.frequencyHistory.length === 0) return 0;
                
                const sum = state.frequencyHistory.reduce((a, b) => a + b, 0);
                return sum / state.frequencyHistory.length;
            }

            // Convertir diferencia de frecuencia a cents
            function frequencyToCents(frequency, targetFrequency) {
                return 1200 * Math.log2(frequency / targetFrequency);
            }

            // Analizar audio en el afinador
            function analyzeAudioAfinador() {
                if (!state.isListening) return;

                const bufferLength = state.analyser.fftSize;
                const dataArray = new Float32Array(bufferLength);
                state.analyser.getFloatTimeDomainData(dataArray);
                
                // Detectar frecuencia (simplificado para demostración)
                // En una implementación real usarías un algoritmo como autocorrelación o FFT
                const detection = detectFrequency(dataArray, state.audioContext.sampleRate);
                
                if (detection.valid) {
                    state.signalStrength = detection.strength;
                    state.lastValidDetection = detection.frequency;
                    
                    // Añadir al historial y calcular promedio móvil
                    addToFrequencyHistory(detection.frequency);
                    const smoothedFrequency = calculateMovingAverage();
                    
                    updateDisplayAfinador(smoothedFrequency);
                }
                
                state.animationId = requestAnimationFrame(analyzeAudioAfinador);
            }

            // Función simplificada de detección de frecuencia
            function detectFrequency(dataArray, sampleRate) {
                // Esta es una versión simplificada para demostración
                // En producción, usarías un algoritmo de detección de pitch real
                
                // Calcular energía de la señal
                let energy = 0;
                for (let i = 0; i < dataArray.length; i++) {
                    energy += dataArray[i] * dataArray[i];
                }
                energy = energy / dataArray.length;
                
                if (energy < 0.001) {
                    return { valid: false, frequency: 0, strength: energy };
                }
                
                // Para demostración: generar una frecuencia aleatoria cerca del objetivo
                const string = STRINGS[state.currentString];
                const randomOffset = (Math.random() - 0.5) * 20; // ±10 Hz
                const simulatedFrequency = string.frequency + randomOffset;
                const simulatedStrength = Math.min(energy * 10, 1);
                
                return { 
                    valid: true, 
                    frequency: simulatedFrequency, 
                    strength: simulatedStrength 
                };
            }

            // Actualizar display con la frecuencia detectada
            function updateDisplayAfinador(frequency) {
                const string = STRINGS[state.currentString];
                
                // Calcular diferencia en cents
                const cents = frequencyToCents(frequency, string.frequency);
                
                // Redondear a números enteros
                const displayFrequency = Math.round(frequency);
                const displayCents = Math.round(cents);
                
                // Actualizar displays
                if (elementsAfinador.frequencyDisplay) {
                    elementsAfinador.frequencyDisplay.textContent = `${displayFrequency} Hz`;
                }
                if (elementsAfinador.centsDisplay) {
                    elementsAfinador.centsDisplay.textContent = `${cents > 0 ? '+' : ''}${displayCents} cents`;
                }
                
                // Actualizar calidad de señal
                const qualityPercent = Math.min(state.signalStrength * 100, 100);
                if (elementsAfinador.qualityLevel) {
                    elementsAfinador.qualityLevel.style.width = `${qualityPercent}%`;
                }
                if (elementsAfinador.qualityValue) {
                    elementsAfinador.qualityValue.textContent = `${Math.round(qualityPercent)}%`;
                }
                
                // Actualizar aguja
                updateNeedleAfinador(cents);
                
                // Actualizar círculo y texto según la desviación
                updateDeviationDisplayAfinador(cents, string);
            }

            // Actualizar posición de la aguja
            function updateNeedleAfinador(cents) {
                if (!elementsAfinador.needle) return;
                
                const maxDisplayCents = 50;
                const limitedCents = Math.max(Math.min(cents, maxDisplayCents), -maxDisplayCents);
                const rotation = (limitedCents / maxDisplayCents) * 90;
                elementsAfinador.needle.style.transform = `rotate(${rotation}deg)`;
            }

            // Actualizar display de desviación
            function updateDeviationDisplayAfinador(cents, string) {
                const absCents = Math.abs(cents);
                let status, colorClass, text;
                
                if (absCents <= 8) {
                    status = 'perfect';
                    colorClass = 'perfect';
                    text = `¡Perfecto!`;
                    if (elementsAfinador.statusText) {
                        elementsAfinador.statusText.innerHTML = `🎵 <strong>¡${string.note} perfectamente afinado!</strong>`;
                    }
                } else if (absCents <= 20) {
                    status = 'warning';
                    colorClass = cents > 0 ? 'sharp' : 'flat';
                    text = cents > 0 ? 'Agudo' : 'Grave';
                    if (elementsAfinador.statusText) {
                        elementsAfinador.statusText.textContent = cents > 0 ? 
                            `🎵 ${string.note} un poco AGUDO - Afloja ligeramente` : 
                            `🎵 ${string.note} un poco GRAVE - Aprieta ligeramente`;
                    }
                } else {
                    status = 'out';
                    colorClass = cents > 0 ? 'sharp' : 'flat';
                    text = cents > 0 ? 'Muy agudo' : 'Muy grave';
                    if (elementsAfinador.statusText) {
                        elementsAfinador.statusText.textContent = cents > 0 ? 
                            `🎵 ${string.note} muy AGUDO - Afloja la clavija` : 
                            `🎵 ${string.note} muy GRAVE - Aprieta la clavija`;
                    }
                }
                
                // Aplicar cambios al display
                if (elementsAfinador.circleIndicator) {
                    elementsAfinador.circleIndicator.className = `circle-indicator ${colorClass}`;
                }
                if (elementsAfinador.deviationText) {
                    elementsAfinador.deviationText.textContent = text;
                }
            }

            // ========== METRÓNOMO MEJORADO ==========
            // Variables del metrónomo
            let metronomo = {
                isPlaying: false,
                bpm: 120,
                timeSignatureTop: 4,
                subdivision: 1,
                beatCount: 0,
                timer: null,
                tapTimes: [],
                audioContext: null
            };

            // Elementos del DOM del metrónomo
            const metronomoElements = {
                bpmValue: document.getElementById('bpmValue'),
                currentBpm: document.getElementById('currentBpm'),
                bpmSlider: document.getElementById('bpmSlider'),
                timeTop: document.getElementById('timeTop'),
                startBtn: document.getElementById('startBtn'),
                stopBtn: document.getElementById('stopBtn'),
                tapTempoBtn: document.getElementById('tapTempoBtn'),
                beatDisplay: document.getElementById('beatDisplay'),
                subdivisionButtons: document.getElementById('subdivisionButtons')
            };

            // Inicializar el metrónomo
            function initMetronomo() {
                if (!metronomoElements.bpmValue) return;
                
                // Contexto de audio
                metronomo.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Inicializar display de compás
                initBeatDisplayMetronomo();
                
                // Event Listeners del metrónomo
                setupMetronomoEventListeners();
                
                // Teclado shortcuts
                document.addEventListener('keydown', handleMetronomoKeyboardShortcuts);
                
                // Asegurarse de que el audio context se active con un clic del usuario
                document.body.addEventListener('click', function() {
                    if (metronomo.audioContext && metronomo.audioContext.state === 'suspended') {
                        metronomo.audioContext.resume();
                    }
                }, { once: true });
            }

            // Configurar event listeners del metrónomo
            function setupMetronomoEventListeners() {
                // Slider de BPM
                metronomoElements.bpmSlider?.addEventListener('input', () => {
                    setBpmMetronomo(parseInt(metronomoElements.bpmSlider.value));
                });
                
                // Compás
                metronomoElements.timeTop?.addEventListener('change', () => {
                    setTimeSignatureMetronomo(parseInt(metronomoElements.timeTop.value));
                });
                
                // Botones de subdivisión
                metronomoElements.subdivisionButtons?.querySelectorAll('.subdivision-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        setSubdivisionMetronomo(button.dataset.value);
                    });
                });
                
                // Botones de inicio/detención
                metronomoElements.startBtn?.addEventListener('click', startMetronomo);
                metronomoElements.stopBtn?.addEventListener('click', stopMetronomo);
                
                // Tap tempo
                metronomoElements.tapTempoBtn?.addEventListener('click', tapTempoMetronomo);
            }

            // Inicializar display de compás
            function initBeatDisplayMetronomo() {
                if (!metronomoElements.beatDisplay) return;
                
                metronomoElements.beatDisplay.innerHTML = '';
                for (let i = 0; i < metronomo.timeSignatureTop; i++) {
                    const beatCell = document.createElement('div');
                    beatCell.className = 'beat-cell';
                    if (i === 0) beatCell.classList.add('accent');
                    beatCell.textContent = i + 1;
                    metronomoElements.beatDisplay.appendChild(beatCell);
                }
            }

            // Establecer BPM
            function setBpmMetronomo(value) {
                metronomo.bpm = Math.max(40, Math.min(240, value));
                
                if (metronomoElements.bpmValue) {
                    metronomoElements.bpmValue.textContent = metronomo.bpm;
                }
                if (metronomoElements.currentBpm) {
                    metronomoElements.currentBpm.textContent = metronomo.bpm;
                }
                if (metronomoElements.bpmSlider) {
                    metronomoElements.bpmSlider.value = metronomo.bpm;
                }
                
                // Reiniciar el temporizador si está en ejecución
                if (metronomo.isPlaying) {
                    stopMetronomo();
                    startMetronomo();
                }
            }

            // Establecer compás
            function setTimeSignatureMetronomo(top) {
                metronomo.timeSignatureTop = Math.max(1, Math.min(4, top));
                
                if (metronomoElements.timeTop) {
                    metronomoElements.timeTop.value = metronomo.timeSignatureTop;
                }
                
                // Reiniciar el contador de tiempo
                metronomo.beatCount = 0;
                
                // Actualizar display de compás
                initBeatDisplayMetronomo();
                
                // Reiniciar el temporizador si está en ejecución
                if (metronomo.isPlaying) {
                    stopMetronomo();
                    startMetronomo();
                }
            }

            // Establecer subdivisión
            function setSubdivisionMetronomo(value) {
                metronomo.subdivision = parseInt(value);
                
                // Actualizar botones de subdivisión
                if (metronomoElements.subdivisionButtons) {
                    metronomoElements.subdivisionButtons.querySelectorAll('.subdivision-btn').forEach(btn => {
                        if (parseInt(btn.dataset.value) === metronomo.subdivision) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                }
                
                // Reiniciar el temporizador si está en ejecución
                if (metronomo.isPlaying) {
                    stopMetronomo();
                    startMetronomo();
                }
            }

            // Crear sonido del metrónomo
            function playSoundMetronomo(isAccent) {
                if (!metronomo.audioContext) return;
                
                // Crear oscilador
                const oscillator = metronomo.audioContext.createOscillator();
                const gainNode = metronomo.audioContext.createGain();
                
                // Configurar frecuencia según si es acento o no
                oscillator.frequency.value = isAccent ? 800 : 600;
                oscillator.type = 'sine';
                
                // Configurar volumen
                gainNode.gain.value = isAccent ? 0.8 : 0.5;
                
                // Conectar nodos
                oscillator.connect(gainNode);
                gainNode.connect(metronomo.audioContext.destination);
                
                // Configurar envolvente de volumen
                const now = metronomo.audioContext.currentTime;
                gainNode.gain.setValueAtTime(0, now);
                gainNode.gain.linearRampToValueAtTime(isAccent ? 0.8 : 0.5, now + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                
                // Iniciar y detener sonido
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            }

            // Iniciar metrónomo
            function startMetronomo() {
                if (metronomo.isPlaying) return;
                
                metronomo.isPlaying = true;
                if (metronomoElements.startBtn) metronomoElements.startBtn.disabled = true;
                if (metronomoElements.stopBtn) metronomoElements.stopBtn.disabled = false;
                
                // Calcular intervalo basado en BPM y subdivisión
                const interval = (60000 / metronomo.bpm) * (1 / metronomo.subdivision);
                
                // Iniciar temporizador
                metronomo.timer = setInterval(() => {
                    // Determinar si es el primer tiempo (acento)
                    const totalBeats = metronomo.timeSignatureTop * metronomo.subdivision;
                    const currentSubBeat = metronomo.beatCount % totalBeats;
                    const isFirstBeatOfMeasure = currentSubBeat === 0;
                    
                    // Reproducir sonido (acento en primer tiempo del compás)
                    playSoundMetronomo(isFirstBeatOfMeasure);
                    
                    // Actualizar visualización de compás
                    updateBeatDisplayMetronomo();
                    
                    // Incrementar contador de tiempo
                    metronomo.beatCount++;
                }, interval);
            }

            // Detener metrónomo
            function stopMetronomo() {
                if (!metronomo.isPlaying) return;
                
                metronomo.isPlaying = false;
                if (metronomoElements.startBtn) metronomoElements.startBtn.disabled = false;
                if (metronomoElements.stopBtn) metronomoElements.stopBtn.disabled = true;
                
                clearInterval(metronomo.timer);
                
                // Resetear display de compás
                if (metronomoElements.beatDisplay) {
                    const beatCells = metronomoElements.beatDisplay.querySelectorAll('.beat-cell');
                    beatCells.forEach(cell => cell.classList.remove('active'));
                }
            }

            // Actualizar display de compás
            function updateBeatDisplayMetronomo() {
                if (!metronomoElements.beatDisplay) return;
                
                const beatCells = metronomoElements.beatDisplay.querySelectorAll('.beat-cell');
                const currentBeat = Math.floor(metronomo.beatCount / metronomo.subdivision) % metronomo.timeSignatureTop;
                
                // Remover clase activa de todas las celdas
                beatCells.forEach(cell => cell.classList.remove('active'));
                
                // Agregar clase activa a la celda actual
                if (beatCells[currentBeat]) {
                    beatCells[currentBeat].classList.add('active');
                }
            }

            // Función Tap Tempo
            function tapTempoMetronomo() {
                const now = Date.now();
                metronomo.tapTimes.push(now);
                
                // Mantener solo los últimos 4 taps
                if (metronomo.tapTimes.length > 4) {
                    metronomo.tapTimes.shift();
                }
                
                // Calcular BPM si hay al menos 2 taps
                if (metronomo.tapTimes.length > 1) {
                    const intervals = [];
                    for (let i = 1; i < metronomo.tapTimes.length; i++) {
                        intervals.push(metronomo.tapTimes[i] - metronomo.tapTimes[i - 1]);
                    }
                    
                    const averageInterval = intervals.reduce((a, b) => a + b) / intervals.length;
                    const calculatedBpm = Math.round(60000 / averageInterval);
                    
                    // Establecer BPM (limitado a 40-240)
                    setBpmMetronomo(Math.max(40, Math.min(240, calculatedBpm)));
                }
                
                // Animación de feedback visual
                if (metronomoElements.tapTempoBtn) {
                    metronomoElements.tapTempoBtn.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        metronomoElements.tapTempoBtn.style.transform = 'scale(1)';
                    }, 100);
                }
            }

            // Manejar teclado shortcuts del metrónomo
            function handleMetronomoKeyboardShortcuts(e) {
                // Solo procesar shortcuts si estamos en la página del metrónomo
                if (!document.getElementById('metronomo')?.classList.contains('active')) {
                    return;
                }
                
                switch(e.key) {
                    case ' ':
                        e.preventDefault();
                        if (metronomo.isPlaying) {
                            stopMetronomo();
                        } else {
                            startMetronomo();
                        }
                        break;
                    case 'ArrowUp':
                        e.preventDefault();
                        setBpmMetronomo(metronomo.bpm + 1);
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        setBpmMetronomo(metronomo.bpm - 1);
                        break;
                    case 't':
                    case 'T':
                        tapTempoMetronomo();
                        break;
                }
            }

            // Funciones de administración
            window.manageUsers = function() {
                alert('Redirigiendo a gestión de usuarios...');
            };

            window.manageContent = function() {
                alert('Redirigiendo a gestión de contenido...');
            };

            window.viewStatistics = function() {
                alert('Redirigiendo a estadísticas...');
            };

            // ========== ANIMACIONES Y EFECTOS ==========
            // Efecto de escritura en el hero
            const heroText = document.querySelector('.hero h1');
            const originalText = heroText.textContent;
            heroText.textContent = '';
            let i = 0;
            
            function typeWriter() {
                if (i < originalText.length) {
                    heroText.textContent += originalText.charAt(i);
                    i++;
                    setTimeout(typeWriter, 50);
                }
            }
            
            // Iniciar animación después de 500ms
            setTimeout(typeWriter, 500);
        });
    </script>
</body>
</html>